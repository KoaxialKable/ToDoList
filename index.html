<!-- index.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>Hello React</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type="text/jsx">
var TodoRow = React.createClass({
  getInitialState: function() {
    return {id: this.props.id, editMode: this.props.focused}
  },


  editClick: function() {
    this.props.editClick(this);
  },

  updateClick: function() {
    this.props.updateClick(this);
  },

  deleteClick: function() {
    this.props.deleteClick(this);
  },

  render: function() {
    var editMode = this.props.focused;
    if (editMode) {
      return (
        <li key={this.props.id} className="TodoRowEdit">
          <input type="text" ref="txtUpdate" defaultValue={this.props.text}/>
          <button type="button" ref="btnUpdate" onClick={this.updateClick}>Update</button>
          <button type="button" ref="btnCancel" onClick={this.editClick}>Cancel</button>
        </li>
      );
    } else {
      return (
        <li key={this.props.id} className="TodoRow">
          <span>{this.props.text}</span>
          <button type="button" ref="btnEdit" onClick={this.editClick}>Edit</button>
          <button type="button" ref="btnDelete" onClick={this.deleteClick}>Delete</button>
        </li>
      );
    }
  }
});




var TodoList = React.createClass({
  getInitialState: function() {
    return {focusID: null, list: this.props.list};
  },


  editClick: function(childComponent) {
    var childID = childComponent.state.id;
    if (this.state.focudID == childID) {
      this.setState({focusID: null});
    } else {
      this.setState({focusID: childID});
    };
    
  },

  updateClick: function(childComponent) {
    var newText = childComponent.refs.txtUpdate.getDOMNode().value;
    var idToUpdate = childComponent.state.id;
    var list = this.state.list;
    list[idToUpdate].text = newText;
    this.setState({focusID: null, list: list})
  },

  deleteClick: function(childComponent) {
    var idToDelete = childComponent.state.id;
    var list = this.state.list;
    list.splice(idToDelete, 1);
    this.setState({list: list})
  },

  addNewItem: function() {
    var list = this.state.list;
    list.push({text: "New Item"})
    var focusOn = list.length-1;
    this.setState({list: list, focusID: focusOn})
  },


  render: function() {
    var focusID = this.state.focusID;
    var listNodes = this.props.list.map(function (todoItem, i) {
      return (
        <TodoRow
          text={todoItem.text}
          focused={i == focusID}
          id={i}
          editClick={this.editClick}
          updateClick={this.updateClick}
          deleteClick={this.deleteClick}
        />
      );
    }, this);
    return (
      <div className="TodoList">
        <h3>To do:</h3>
        <ul>
          {listNodes}
          <li key="add"><button type="button" onClick={this.addNewItem}>Add</button></li>
        </ul>

      </div>
    );
  }
});

var initialList = [
  {text: "Walk dog"},
  {text: "Do laundry"},
  {text: "Do dishes"}
];


React.render(<TodoList list={initialList} />, document.getElementById('content'));
    </script>
  </body>
</html>